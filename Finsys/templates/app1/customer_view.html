{% extends 'app1/base.html' %}
{% block body %}
{% load social_share %}
    {% load static %}
    {% if user.is_authenticated %}
    <style>
        .card-registration .select-input.form-control[readonly]:not([disabled]) {
            font-size: 1rem;
            line-height: 2.15;
            padding-left: .75em;
            padding-right: .75em;
        }
        .card-registration .select-arrow {
            top: 13px;
        }
        .bg-grey {
            background-color: rgba(0, 0, 0, 0.4);
        }
        @media (min-width: 992px) {
            .card-registration-2 .bg-grey {
                border-top-right-radius: 16px;
                border-bottom-right-radius: 16px;
            }
        }
        @media (max-width: 991px) {
            .card-registration-2 .bg-grey {
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
            }
        }
        .vl {
            border-left: 6px solid gray;
        }
        .table-row{
        cursor:pointer;
}
/* hr {
        border: 0;
        clear:both;
        display:block;
        width: 96%;               
        background-color:#000000;
        height: 1px;
      } */
    .spaced>li {
        color:black;
        font-size:10px;
    }

    .table1{
        font-size:10px;
        width:100% ;
        color:black;

    }
    .label-lg {
            padding: .3em .6em .4em;
            font-size: 12px;
            color:black;
            line-height: 1.1;
            height: 24px
    }
    .widget-header{
        background-color:#444;
        color:white;
        font-size:14px;
    }
    .widget-header:after,
    .widget-header:before {
            content: "";
            display: table;
            line-height: 0
    }
    .widget-header:after {
            clear: right
    }
    .widget-box.collapsed>.widget-header {
            border-bottom-width: 0
        }
        
        .collapsed.fullscreen>.widget-header {
            border-bottom-width: 1px
        }
        
        .collapsed>.widget-body {
            display: none
        }
        
        .widget-header-flat {
            background: #F7F7F7
        }
        
        .widget-header-large {
            min-height: 49px;
            padding-left: 18px
        }
        

        
        .widget-header-small {
            min-height: 31px;
            padding-left: 10px
        }
        
        .widget-header>.widget-title {
            line-height: 36px;
            padding: 0;
            margin: 0;
            display: inline;
            font-size:13px;
        }
        
        
        
        .widget-toolbar {
            display: inline-block;
            padding: 0 10px;
            line-height: 37px;
            float: right;
            position: relative
        }
        
        
        
        
        
       
        
        .widget-body {
            background-color: #FFF
        }
        
        .widget-main {
            padding: 12px
        }

        @media print{
        body{
            visibility: hidden !important; /* hide everything in body when in print mode*/
        }

        .printContainer {
            visibility: visible !important; /* Override the rule above to only show the printables*/
            position: absolute;
            z-index: 99999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: large;
        } 
    }
        
    #listdiv li:hover{
        background-color: grey;
        padding-bottom: 1vh;
    }
    #listdiv li{
        padding-bottom: 1vh;
    }
       
    </style>
    <script>

        function Details() {
            document.getElementById('details').style.display = 'block';
            document.getElementById('statment').style.display = 'none';
            document.getElementById('transation').style.display = 'none';
            document.getElementById('form1').style.display = 'none';
            document.getElementById('printlink').style.display = 'none';
            document.getElementById('pdflink').style.display = 'none';
            document.getElementById('sharelink').style.display = 'none';
            document.getElementById('detailslink').style.backgroundColor='rgba(22,37,50,255)'
            document.getElementById('transactionlink').style.backgroundColor='transparent'
            document.getElementById('statementlink').style.backgroundColor='transparent'
            
            top_element = document.getElementById('top')
            top_element.classList.remove('col-md-4')
            top_element.classList.add('col-md-7')

            bottom_element = document.getElementById('bottom')
            bottom_element.classList.remove('col-md-8')
            bottom_element.classList.add('col-md-5')
        }
        
        function Statment() {
            document.getElementById('details').style.display = 'none';
            document.getElementById('statment').style.display = 'block';
            document.getElementById('transation').style.display = 'none';
            document.getElementById('form1').style.display = 'block';
            document.getElementById('printlink').style.display = 'block';
            document.getElementById('pdflink').style.display = 'block';
            document.getElementById('sharelink').style.display = 'block';
            document.getElementById('detailslink').style.backgroundColor='transparent'
            document.getElementById('transactionlink').style.backgroundColor='transparent'
            document.getElementById('statementlink').style.backgroundColor='rgba(22,37,50,255)'

            top_element = document.getElementById('top')
            top_element.classList.remove('col-md-7')
            top_element.classList.add('col-md-4')

            bottom_element = document.getElementById('bottom')
            bottom_element.classList.remove('col-md-5')
            bottom_element.classList.add('col-md-8')
        }
        function transaction() {
            document.getElementById('details').style.display = 'none';
            document.getElementById('statment').style.display = 'none';
            document.getElementById('transation').style.display = 'block';
            document.getElementById('form1').style.display = 'none';
            document.getElementById('printlink').style.display = 'none';
            document.getElementById('pdflink').style.display = 'none';
            document.getElementById('sharelink').style.display = 'none';
            document.getElementById('detailslink').style.backgroundColor='transparent'
            document.getElementById('transactionlink').style.backgroundColor='rgba(22,37,50,255)'
            document.getElementById('statementlink').style.backgroundColor='transparent'  
            
            top_element = document.getElementById('top')
            top_element.classList.remove('col-md-4')
            top_element.classList.add('col-md-7')    
            
            bottom_element = document.getElementById('bottom')
            bottom_element.classList.remove('col-md-8')
            bottom_element.classList.add('col-md-5')
        }
        function filterDate(element) {
            if (element.value == 'Custom') {
                document.getElementById('frdate').style.display = 'block';
                document.getElementById('todate').style.display = 'block';
            } else {
                document.getElementById('frdate').style.display = 'none';
                document.getElementById('todate').style.display = 'none';
            }
        }

    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js" ></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js" ></script>
   
<script>


    async function generatePDF() {
        // document.getElementById("downloadButton").innerHTML = "Currently downloading, please wait";

        //Downloading
        var downloading = document.getElementById("whatToPrint");
        var doc = new jsPDF('l', 'pt');

        await html2canvas(downloading, {
            //allowTaint: true,
            //useCORS: true,
            // width: 600
            
        }).then((canvas) => {
            //Canvas (convert to PNG)
            doc.addImage(canvas.toDataURL("image/png"), 'PNG', 100, 20, 600, 550);
        })

        doc.save("Document.pdf");

        //End of downloading

        // document.getElementById("downloadButton").innerHTML = "Click to download";
    }

    
</script>



<!-- modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add File</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="{% url 'cust_add_file' customer.customerid %}" method="POST" enctype="multipart/form-data">{% csrf_token %}
        <div class="modal-body">
          <input type="file" class="form-control" name="file">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
    </form>
      </div>
    </div>
  </div>




<!-- /modal-->






    <div class="page-content " >
        <div class="card radius-15">
            <div class="card-body" style="width:100%;">
                <div class="card-title">
                    <center><h2 class="mb-0">{{ customer.title }}. {{ customer.firstname }} {{ customer.lastname }}</h2></center>
                    <hr>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-7" style="float: left; " id="top">
    
                                <a style="padding: 10px; cursor: pointer; border-radius: 1vh; background-color: rgba(22,37,50,255);" onclick="Details()" id="detailslink" >Details</a>
                                <a style="padding: 10px; cursor: pointer; border-radius: 1vh;" onclick="transaction()" id="transactionlink" > Transactions</a>
                                <a style="padding: 10px; cursor: pointer; border-radius: 1vh;" onclick="Statment()" id="statementlink" > Statement</a>
                            </div> 
    
                            <div class="col-md-5" id="bottom">
                                <div style="float: right; margin-left: 2vh;">
                                    <div class="dropdown p-0 nav-item"  id="sharelink" style="display: none;">
                                        <li  class=" dropdown-toggle btn btn-outline-info rounded-pill text-grey fa fa-share-alt" data-toggle="dropdown"> Share</li>
                                        <ul class="dropdown-menu" style="background-color: black;" id="listdiv">
                                            <li style="text-align: center;" > {% post_to_whatsapp object_or_url "WhatsApp" %}</li>
                                            <li style="text-align: center;" >{% send_email object.title "Customer Details: {{object.title}}. Check it out!" object_or_url "Email" %}</li>
                                        </ul>
                                    </div>
                                </div>

                                <div style="float: right; margin-left: 2vh;">
                                    <a  class=" btn btn-outline-info rounded-pill text-grey fa fa-file" role="button" id="pdflink" style="display: none;"> &nbsp;PDF</a> 

                                </div>

                                <div style="float: right; margin-left: 2vh;">
                                    <a class=" btn btn-outline-info rounded-pill text-grey fa fa-print  " role="button" id="printlink" style="display: none; " onclick="printtable()">&nbsp;Print</a>

                                </div>

                                <div style="float: right; margin-left: 2vh;">
                                    <button type="button"
                                    class="btn btn-outline-info rounded-pill text-grey dropdown-toggle dropdown-toggle-split fa fa-paperclip" 
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="sr-only ">Toggle Dropdown</span>
                                        Attach file
                                    </button>
    
                                    <div class="dropdown-menu" >
                                        <a class="dropdown-item"  style="cursor: pointer;" data-toggle="modal" data-target="#exampleModal">Attach file</a>
                                        {% if customer.file != "default.jpg" %}
                                        <a class="dropdown-item fa fa-download" style="cursor: pointer;"download  href="{{customer.file.url}}" >Download file</a>
                                        {% endif %}
                                    </div>
                                </div>

                                <div style="float: right; margin-left: 2vh;">
                                    <a href="{% url 'deletecustomer' customer.customerid %}"  class="btn btn-outline-info rounded-pill text-grey fa fa-trash" role="button" >&nbsp;Delete</a>
                                </div>

                                <div style="float: right; margin-left: 2vh;">
                                    {% if customer.status == act%}
                                    <a href="{% url 'inactive_cust' customer.customerid %}" class=" fa fa-exchange btn btn-outline-info rounded-pill text-grey " role="button" >&nbsp;Activate</a> 
                                    {% else %}
                                    <a href="{% url 'active_cust' customer.customerid %}" class=" fa fa-exchange btn btn-outline-info rounded-pill text-grey " role="button" >&nbsp;Deactivate</a> 
                                    {% endif %}
                                </div>

                                <div style="float: right;"> 
                                    <a href="{% url 'editcustomer' customer.customerid %}" class=" fa fa-pencil btn btn-outline-info rounded-pill text-grey  "  role="button">
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
            </div>
        </div>

        <!-- <form id="form_post" >
            <label>From</label><input type="date" id="fdate" name="fdate"  > 
            <label>To</label><input type="date" id="ldate" name="ldate" >
            <button class="btn" type="submit"> Search</button>
            </form> -->
        <div class="card radius-15" id="form1" style="display: none;">
            <div class="card-body">
                
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-sm-4">
                            <label style="text-align:left ">Report period</label><br>
                            <form id="form_post"  class="needs-validation" novalidate>
                            <select class="form-control" id="filterstyle" onclick="filterDate(this)"
                                    list="hosting-plan"
                                    type="text">
                                    <option hidden>Select Report Period</option>
                                <option><span class="bx bx-right-arrow-alt"></span>Custom</option>
                            </select>
                        </div>
                        
                        <div class="col-sm-4" id="frdate" style="display: none;">
                            <label for="from">From</label>
                            <input type="date" class="form-control" id="fdate" name="fdate"
                                   style="background-color: #2f516f;color: white;">
                        </div>
                        <div class="col-sm-4" id="todate" style="display: none;">
                            <label for="from">To</label>
                            <input type="date" class="form-control" id="ldate" name="ldate"
                                   style="background-color: #2f516f;color: white;">
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </form>
            </div>
        </div>


        <div class="card card-registration card-registration-2" style="border-radius: 15px;"  >
            <div class="card-body p-0" >
                <div id="details"  >
                    <div class="row g-0" style="margin-left: 1px; margin-right: 1px;">
                        <div class="col-lg-8">
                            <div class="p-5">
                                <div class="d-flex justify-content-between align-items-center mb-5">
                                    <h1 class="fw-bold mb-0 text-black">{{ customer.title }}. {{ customer.firstname }} {{ customer.lastname }}</h1>
                                </div>
                                <hr class="my-4">
                                <div class="row mb-4 d-flex justify-content-between align-items-center">
                                    <div class="col-md-2 mt-3">
                                        <h6 class="mb-0">Company</h6>
                                    </div>
                                    <div class="col-md-1 mt-3">
                                        :
                                    </div>
                                    <div class="col-md-3 mt-3">
                                        <p class="mb-0">{{ customer.company }}</p>
                                    </div>
                                    <div class="col-md-2 mt-3 vl">
                                        <h6 class="mb-0">Email</h6>
                                    </div>
                                    <div class="col-md-1 mt-3">
                                        :
                                    </div>
                                    <div class="col-md-3 mt-3">
                                        <p class="mb-0">{{ customer.email }}</p>
                                    </div>
                                </div>
                                <div class="row mb-4 d-flex justify-content-between align-items-center">
                                    <div class="col-md-2 mt-3">
                                        <h6 class="mb-0">Mobile</h6>
                                    </div>
                                    <div class="col-md-1 mt-3">
                                        :
                                    </div>
                                    <div class="col-md-3 mt-3">
                                        <p class="mb-0">{{ customer.mobile }}</p>
                                    </div>
                                    
                                    <div class="col-md-2 mt-3 vl">
                                        <h6 class="mb-0">Website</h6>
                                    </div>
                                    <div class="col-md-1 mt-3">
                                        :
                                    </div>
                                    {% if customer.website  %}
                                    <div class="col-md-3 mt-3">
                                        <p class="mb-0">{{ customer.website }}</p>
                                    </div>
                                    {% else %}
                                    <div class="col-md-3 mt-3">
                                        <p class="mb-0">none</p>
                                    </div>
                                    {% endif %}
                                </div>
                                <hr class="my-4"><br>

                                <div class="row ">
                                    <div class="col-md-6" >
                                        <div class="card-content bg-transparent border-0 ml-4" >
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <h5 class="ml-3" style="text-align: center;">Billing Address</h5>
                                                    <hr>
                                                </div>
                                            </div><br>
                                            <div class="row">
                                                <div class="col-md-3" >
                                                    <h6 class="mb-0">Street</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.street }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">City</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.city }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">State</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.state }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">Pincode</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.pincode }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">Country</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.country }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card-content bg-transparent border-0 ml-4" >
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <h5 class="ml-3" style="text-align: center;">Shipping Address</h5>
                                                    <hr>
                                                </div>
                                            </div><br>
                                            <div class="row">
                                                <div class="col-md-3" >
                                                    <h6 class="mb-0">Street</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.shipstreet }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">City</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.shipcity }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">State</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.shipstate }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">Pincode</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.shippincode }}</p>
                                                </div>
                                            </div><br><br>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <h6 class="mb-0">Country</h6>
                                                </div>
                                                <div class="col-md-1">
                                                    :
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-0" style="text-align: right;">{{ customer.shipcountry }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4" style="background-color: rgba(22,37,50,255); border-top-right-radius:2vh; border-bottom-right-radius: 2vh;">
                            <div class="p-5">
                                <h3 class="fw-bold mb-3 mt-2 pt-1">GST</h3>
                                <hr class="my-4" style="background-color: #fff;">
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">Customer Status</h5>
                                    <h6>{{ customer.status }}</h6>
                                </div>
                                {% if customer.gstin %}
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">GST Number</h5>
                                    <h6 >{{ customer.gstin }}</h6>
                                </div>
                                {% endif %}
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">GST Type</h5>
                                    <h6 style="text-align: right;">{{customer.gsttype }}</h6>
                                </div>
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">PAN Number</h5>
                                    <h6>{{ customer.panno }}</h6>
                                </div>
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">Opening Balance</h5>
                                    <h6 id="open1">{{ customer.opening_balance }}</h6>
                                </div>
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">Credit Limit</h5>
                                    <h6>{{ customer.credit_limit }}</h6>
                                </div>
                                <div class="d-flex justify-content-between mb-4">
                                    <h5 class="">Balance</h5>
                                    <h6 id="open2">{{ customer.opening_balance }}</h6>
                                </div>
                                <hr class="my-4" style="background-color: #fff;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="statment" style="display: none;">
                    <div class="container-fluid" >
                        <div class="py-5" >
                            <div class="row hidden-md-up" style="margin-top: 15px;" >
                                <div class="col-md-9" style="margin: auto;"  size="A4">
                                    <div class="card" id="printdiv">
                                        <div id="whatToPrint">
                                            <div class="card-block">
                                                <div class="card-body">
                                                    <div class="container bootdey"  >
                                                        <div class="row">
                                                            <div class="col-sm-12 col-sm-offset-1" style="padding:20px;"  >
                                                                <div class="widget-box">
                                                                    <div class="widget-body">
                                                                        <div class="widget-main padding-24">
                                                                            <div class="row"  style="padding:20px;" >
                                                                                <div class="col-sm-12" style="background-image: linear-gradient(#1b83e8, black); color: white;">
                                                                                    <p style="font-size: 4vh; text-align: center;">Statement of Accounts</p>
                                                                                    <p style=" text-align: center;"> {{cmp1.cname}} <br>
                                                                                        {{cmp1.caddress}} <br>
                                                                                        {{cmp1.city}},
                                                                                        {{cmp1.state}}<br>
                                                                                        {{cmp1.cemail}}
                                                                                        <br></p>
                                                                                    <!-- <div class="col-6">
                                                                                        <div style="width:30px;">
                                                                                            <img src="/media/images/default.png">
                                                                                            </div>
                                                                        
                                                                                    </div><br> -->
                                                                                </div><!-- /.col -->
                                                                            </div><!-- /.row -->
                                                                            <br>
                                                                            <div class="row col-12">
                                                                                <div class="col-6">
                                                                                    <p style="color:black; font-weight: bold;">Customer Details : </p>
                                                                                    <p style="color:black;">{{customer.firstname}} {{customer.lastname}}<br>
                                                                                        {{customer.street}},{{customer.city}}<br>
                                                                                        {{customer.state}},{{customer.country}}<br>
                                                                                        {{customer.pincode }}<br>
                                                                                        {{customer.email}}<br>
                                                                                        {{customer.phone}}<br>
                                                                                    </p>
                                                                                </div>
                                                                                <div class="col-md-2"></div><br>
                                                                                <div class="col-4 ">
                                                                                    <div class="d-flex justify-content-between" style="color: black;">
                                                                                        <p class="" style="font-weight: bold;">Opening balance</p>
                                                                                        <p>:</p>
                                                                                        <p id="open3">{{ bal_amount }}</p>
                                                                                    </div>
                                                                                    <div class="d-flex justify-content-between " style="color: black;">
                                                                                        <p class="" style="font-weight: bold;">Invoiced Amount</p>
                                                                                        <p>:</p>
                                                                                        <p>{{ invoiced }}</p>
                                                                                    </div>
                                                                                    <div class="d-flex justify-content-between " style="color: black;">
                                                                                        <p class="" style="font-weight: bold;">Amount Received</p>
                                                                                        <p>:</p>
                                                                                        <p>{{ re }}</p>
                                                                                    </div>
                                                                                    <div class="d-flex justify-content-between " style="color: black;">
                                                                                        <p class="" style="font-weight: bold;">Balance Due</p>
                                                                                        <p>:</p>
                                                                                        <p id="open4">{{ baldue }}</p>
                                                                                    </div>
                                                                                </div>
                                                                            </div><br>
                                                                            <div class="col-md-12">
                                                                                <table border="0" id="logic" class=" table-striped" width="100%" style="color:black;">
                                                                                    <thead class="thead-dark">
                                                                                        <tr class="bg-dark text-white" style="text-align: center;">
                                                                                            <th>Date</th>
                                                                                            <th>Transactions</th>
                                                                                            <th>Bill Number</th>
                                                                                            <th>Total</th>
                                                                                            <th>Balance</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody style="text-align: center;">
                                                                                        {% for estimate in est1 %}
                                                                                        <tr>
                                                                                            <td>{{ estimate.estimatedate | date:'d-m-Y' }}</td>
                                                                                            <td>Estimate</td>
                                                                                            <td>{{ estimate.estimateno }}</td>
                                                                                            <td>{{ i.estimatetotal }}</td>
                                                                                            <td>{{ estimate.estimatetotal }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                                                                
                                                                                        {% for sale in sel1 %}
                                                                                        <tr>
                                                                                            <td>{{ sale.saledate | date:'d-m-Y' }}</td>
                                                                                            <td>Sales Order</td>
                                                                                            <td>{{ sale.saleno }}</td>
                                                                                            <td>{{ sale.salestotal }}</td>
                                                                                            <td>{{ sale.balance }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                                                        
                                                                                        {% for invoices in invs %}
                                                                                        <tr>
                                                                                            <td>{{ invoices.invoicedate | date:'d-m-Y' }}</td>
                                                                                            <td>Invoice</td>
                                                                                            <td>{{ invoices.invoiceno }}</td>
                                                                                            <td>{{ invoices.grandtotal }}</td>
                                                                                            <td>{{ invoices.baldue }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                    
                                                                                        {% for note in crd_note %}
                                                                                        <tr>
                                                                                            <td>{{ note.creditdate | date:'d-m-Y' }}</td>
                                                                                            <td>Credit Note</td>
                                                                                            <td>{{ note.credit_no }}</td>
                                                                                            <td>{{ note.grandtotal }}</td>
                                                                                            <td>{{ note.grandtotal }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                                                                                                    
                                                                                        {% for i in payme %}
                                                                                        <tr>
                                                                                            <td>{{ i.paymdate  | date:'d-m-Y' }}</td>
                                                                                            <td>Customer Payment</td>
                                                                                            <td>{{ i.refno }}</td>
                                                                                            <td>{{ i.amtcredit }}</td>
                                                                                            <td>{{ i.balance }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                            
                                                                                        {% for inv in ret_inv %}
                                                                                        <tr>
                                                                                            <td>{{ inv.invoice_date  | date:'d-m-Y' }}</td>
                                                                                            <td>Retainer Invoice</td>
                                                                                            <td>{{ inv.invoice_number }}</td>
                                                                                            <td>{{ inv.total_amount }}</td>
                                                                                            <td>{{ inv.total_amount }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                            
                                                                                        {% for dl in deli %}
                                                                                        <tr>
                                                                                            <td>{{ dl.challan_date  | date:'d-m-Y' }}</td>
                                                                                            <td>Delivary Challan</td>
                                                                                            <td>{{ dl.chal_no }}</td>
                                                                                            <td>{{ dl.grand }}</td>
                                                                                            <td>{{ dl.grand }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                            
                                                                                        {% for rec in recc_inv %}
                                                                                        <tr>
                                                                                            <td>{{ rec.startdate  | date:'d-m-Y' }}</td>
                                                                                            <td>Reccuring Invoice</td>
                                                                                            <td>{{ rec.recinvoiceno }}</td>
                                                                                            <td>{{ rec.grandtotal }}</td>
                                                                                            <td>{{ rec.baldue }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}

                                                                                        {% for m in mjour %}
                                                                                        <tr>
                                                                                            <td>{{ m.mjrnl.date   }}</td>
                                                                                            <td>Manual journal</td>
                                                                                            <td>{{ m.mjrnl.mj_no }}</td>
                                                                                            <td>{{ m.mjrnl.total_deb }}</td>
                                                                                            <td>{{ m.mjrnl.difference }}</td>
                                                                                        </tr>
                                                                                        {% endfor %}
                                                                                    </tbody>
                                                                                </table>
                                                                                <br>
                                                                                <br>
                                                                                <br>
                                                                                <br>
                                                                                <br>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>  
                    </div>
                </div>
                <div id="transation" style="display: none;" >
                    <div class="row" >
                        <div class="mt-5 ml-5" >
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h1 class="fw-bold mb-0 text-black">{{ customer.title }}. {{ customer.firstname }} {{ customer.lastname }}</h1>
                            </div>
                        </div>
                    </div>
                    <div class="row ml-4" >
                        <div class="col-md-3">
                            <div class="d-flex" >
                                <div><h6>Email</h6></div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div><h6>{{customer.email}}</h6></div>
                            </div><br>
                            <div class="d-flex">
                                <div>Credit Limit</div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div><h6>{{customer.credit_limit}}</h6></div>
                            </div><br>
                            <div class="d-flex">
                                <div>Opening Balance</div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div><h6>{{customer.opening_balance}}</h6></div>
                            </div>
                        </div>

                        <div class="col-md-6"></div>

                        <div class="col-md-3 " >
                            <div class="d-flex" style="text-align: right;">
                                <div><h6>Phone</h6></div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div ><h6 >{{customer.mobile}}</h6></div>
                            </div><br>
                            <div class="d-flex">
                                <div>Address</div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div><h6>{{customer.street}},<br>{{customer.city}},{{customer.state}},{{customer.pincode}}</h6></div>
                            </div><br>
                            {% if customer.gstin %}
                            <div class="d-flex">
                                <div>GSTIN</div>
                                <div class="ml-2 mr-2"><h6>:</h6></div>
                                <div><h6>{{customer.gstin}}</h6></div>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row ml-4">
                        <div class="col-md-1"></div>
                        <div class="col-md-3">
                            <input type="text" id="search" placeholder="Search..." class="form-control " autocomplete="off" 
                            style="margin-top: 8px; background-color: #2f516f;color: white; width:50vh; margin-left: -15vh;">
                        </div>
                    </div>

                    <div class="container-fluid">
                        <div class="row ">
                            <table class="table table-responsive-md mr-5 ml-5 mt-3 table-hover text-center" id="transactiontable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>DATE</th>
                                        <th>TYPE</th>
                                        <th>BILL NUMBER</th>
                                        <th>TOTAL</th>
                                        <th>BALANCE</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for estimate in est1 %}
                                    <tr>
                                        <td></td>
                                        <td>{{ estimate.estimatedate | date:'d-m-Y' }}</td>
                                        <td>Estimate</td>
                                        <td>{{ estimate.estimateno }}</td>
                                        <td>{{ i.amtcredit }}</td>
                                        <td>{{ estimate.estimatetotal }}</td>
                                    </tr>
                                    {% endfor %}
                                            
                                    {% for sale in sel1 %}
                                    <tr>
                                        <td></td>
                                        <td>{{ sale.saledate | date:'d-m-Y' }}</td>
                                        <td>Sales Order</td>
                                        <td>{{ sale.saleno }}</td>
                                        <td>{{ sale.salestotal }}</td>
                                        <td>{{ sale.balance }}</td>
                                    </tr>
                                    {% endfor %}
                                    
                                    {% for invoices in invs %}
                                    <tr>
                                        <td></td>
                                        <td>{{ invoices.invoicedate | date:'d-m-Y' }}</td>
                                        <td>Invoice</td>
                                        <td>{{ invoices.invoiceno }}</td>
                                        <td>{{ invoices.grandtotal }}</td>
                                        <td>{{ invoices.baldue }}</td>
                                    </tr>
                                    {% endfor %}

                                    {% for note in crd_note %}
                                    <tr>
                                        <td></td>
                                        <td>{{ note.creditdate | date:'d-m-Y' }}</td>
                                        <td>Credit Note</td>
                                        <td>{{ note.credit_no }}</td>
                                        <td>{{ note.grandtotal }}</td>
                                        <td>{{ note.grandtotal }}</td>
                                    </tr>
                                    {% endfor %}
                                                                                
                                    {% for i in payme %}
                                    <tr>
                                        <td></td>
                                        <td>{{ i.paymdate  | date:'d-m-Y' }}</td>
                                        <td>Customer Payment</td>
                                        <td>{{ i.refno }}</td>
                                        <td>{{ i.amtcredit }}</td>
                                        <td>{{ i.balance }}</td>
                                    </tr>
                                    {% endfor %}
        
                                    {% for inv in ret_inv %}
                                    <tr>
                                        <td></td>
                                        <td>{{ inv.invoice_date  | date:'d-m-Y' }}</td>
                                        <td>Retainer Invoice</td>
                                        <td>{{ inv.invoice_number }}</td>
                                        <td>{{ inv.total_amount }}</td>
                                        <td>{{ inv.total_amount }}</td>
                                    </tr>
                                    {% endfor %}
        
                                    {% for dl in deli %}
                                    <tr>
                                        <td></td>
                                        <td>{{ dl.challan_date  | date:'d-m-Y' }}</td>
                                        <td>Delivary Challan</td>
                                        <td>{{ dl.chal_no }}</td>
                                        <td>{{ dl.grand }}</td>
                                        <td>{{ dl.grand }}</td>
                                    </tr>
                                    {% endfor %}
        
                                    {% for rec in recc_inv %}
                                    <tr>
                                        <td></td>
                                        <td>{{ rec.startdate  | date:'d-m-Y' }}</td>
                                        <td>Reccuring Invoice</td>
                                        <td>{{ rec.recinvoiceno }}</td>
                                        <td>{{ rec.grandtotal }}</td>
                                        <td>{{ rec.baldue }}</td>
                                    </tr>
                                    {% endfor %}
        
                                    {% for m in mjour %}
                                    <tr>
                                        <td></td>
                                        <td>{{ m.mjrnl.date   }}</td>
                                        <td>Manual journal</td>
                                        <td>{{ m.mjrnl.mj_no }}</td>
                                        <td>{{ m.mjrnl.total_deb }}</td>
                                        <td>{{ m.mjrnl.difference }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function ($) {
            $(document).on('click', '#pdflink', function (event) {
                event.preventDefault();
                var element = document.getElementById('printdiv');  
                // element.style.color = 'black';
                // element.style.backgroundColor = 'white';
                var opt =
                {
                    margin: 1,
                    filename: 'Customer' + '.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait', }
                };
                html2pdf().set(opt).from(element).save();
            });
        });
    </script>

<script>
        $(document).ready(function() {
        var $rows = $('.table tbody tr');
        $('#search').keyup(function() {
            var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
            $rows.show().filter(function() {
                console.log($rows.show())

                var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
                console.log(text)
                return !~text.indexOf(val);
            }).hide();
        });
    });
</script>

<script>
    function printtable(){
        var printContents = document.getElementById("printdiv").innerHTML;

        var $printerDiv = $('<div class="printContainer"></div>'); // create the div that will contain the stuff to be printed
        $printerDiv.html(printContents); // add the content to be printed
        $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

        window.print(); // call print
        $printerDiv.remove(); // remove the div
        $('body').removeClass("printingContent");
    }
</script>

    <script>
        function ApplyDateFilter() { 
            const startDate = new Date(document.getElementById('fdate').value);
            const endDate = new Date(document.getElementById('ldate').value);
            document.getElementById("datediv").style.display = "block";
            document.getElementById("df").value = document.getElementById('fdate').value;
            document.getElementById("dl").value = document.getElementById('ldate').value;
            const table = document.querySelector('#logic');
            const rows = table.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                if (index === 0) return; // Skip the header row
                
                const dateCell = new Date(parseDate(row.cells[0].textContent));

                if (dateCell >= startDate && dateCell <= endDate) {
                    row.style.display = ''; // Display rows within the date range
                } else {
                    row.style.display = 'none'; // Hide rows outside the date range
                }
            });
    }

    const fromDateInput = document.getElementById("fdate");
    const toDateInput = document.getElementById("ldate");
    fromDateInput.addEventListener("change", ApplyDateFilter);
    toDateInput.addEventListener("change", ApplyDateFilter);

    function parseDate(input) {

            var parts = input.split('-');
            return parts[1] + '/' + parts[0] + '/' + parts[2];

    }

</script>

<script>
    var table = document.getElementById('transactiontable');
    var rows = table.rows;

    for (var i = 1; i < rows.length; i++) {
        var rowNumber = i;
        rows[i].cells[0].textContent = rowNumber;
    }
</script>

<script>
    function dispinv(){

        document.getElementById('invtable').style.display = 'block';

    }
    function dispay(){

    document.getElementById('paytable').style.display = 'block';

}
function disest(){

document.getElementById('esttable').style.display = 'block';

}
function dissale(){

document.getElementById('saletable').style.display = 'block';

}

</script>
    
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        $(document).ready(function($) {
            $(".table-row").dblclick(function() {
                window.document.location = $(this).data("href");
            });
        });
    </script>
    <script>

$('.delete').click(function(event) {
    var form =  $(this).closest("form");
    var name = $(this).data("name");
    event.preventDefault();
    swal({
        title: `Are you sure you want to delete this record?`,
        text: "If you delete this, it will be gone forever.",
        icon: "warning",
        buttons: true,
        dangerMode: true,
    })
    .then((willDelete) => {
        if (willDelete) {
            swal("Poof! Your imaginary file has been deleted!", {
            icon: "success" ,
      
            });
            form.submit();

            
            
            
            }
    });
});

    </script> 

    <script>
       val1 =  document.getElementById('open1').innerHTML
       val2 =  document.getElementById('open2').innerHTML
       val3 =  document.getElementById('open3').innerHTML
       val4 =  document.getElementById('open4').innerHTML

       if(val1==0){
        val1 = val1.slice(1,);
        val2 = val1.slice(0,);
        val3 = val1.slice(0,);
        val4 = val1.slice(0,);
       }
       document.getElementById('open1').innerHTML = val1
       document.getElementById('open2').innerHTML = val2
       document.getElementById('open3').innerHTML = val3
       document.getElementById('open4').innerHTML = val4
    </script>
{% endif %}
{% endblock %}